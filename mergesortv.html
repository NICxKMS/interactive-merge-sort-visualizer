<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Merge Sort Visualization</title>
    <link rel="stylesheet" href="css/mergesort.css">
    <!-- Add particles.js library -->
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
</head>
<body>
    <!-- Add particles container at the beginning of body -->
    <div id="particles-js"></div>
    
	<div class="container">
		<h1>Advanced Merge Sort Visualization</h1>
		
		<div class="info-panel">
			<h3>Visual Guide</h3>
			<div class="legend">
				<div class="legend-item">
					<div class="legend-color legend-divide"></div>
					<span>Divide Phase</span>
				</div>
				<div class="legend-item">
					<div class="legend-color legend-merge"></div>
					<span>Merge Phase</span>
				</div>
				<div class="legend-item">
					<div class="legend-color legend-leaf"></div>
					<span>Leaf Node</span>
				</div>
			</div>
			<div class="controls-container">
				<div class="control-group speed-control">
					<label for="speed">Animation Speed:</label>
					<input type="range" id="speed" min="10" max="1000" value="300" step="10">
					<span id="speedValue">300ms</span>
				</div>
				<div class="control-group size-control">
					<label for="arraySize">Array Size:</label>
					<input type="number" id="arraySize" min="4" max="32" value="16" step="4">
					<button id="sizeUpdate">Update</button>
				</div>
			</div>
		</div>
		
		<div id="visualization"></div>
		
		<div class="control-panel">
			<button id="startSortBtn">Start Merge Sort</button>
			<button id="resetBtn">Reset</button>
			<button id="pauseResumeBtn">Pause</button>
		</div>
		
		<!-- Step-by-step log container -->
		<div id="stepsOutput"></div>
		
		<!-- Tree visualization containers -->
		<div class="tree-views-container">
			<!-- Divide tree view -->
			<div class="tree-view" id="divideTreeView">
				<div class="tree-view-header">
					<h3>Divide Phase Tree</h3>
				</div>
				<div class="tree-container" id="divideTreeContainer"></div>
				<div class="zoom-controls-wrapper">
					<div class="zoom-controls">
						<div class="zoom-btn" onclick="zoom('divide', 1.2)" title="Zoom in" aria-label="Zoom in">+</div>
						<div class="zoom-btn" onclick="zoom('divide', 0.8)" title="Zoom out" aria-label="Zoom out">−</div>
						<div class="zoom-btn" onclick="resetZoom('divide')" title="Reset zoom" aria-label="Reset zoom">⟲</div>
					</div>
				</div>
			</div>
			
			<!-- Merge tree view -->
			<div class="tree-view" id="mergeTreeView">
				<div class="tree-view-header">
					<h3>Merge Phase Tree</h3>
				</div>
				<div class="tree-container" id="mergeTreeContainer"></div>
				<div class="zoom-controls-wrapper">
					<div class="zoom-controls">
						<div class="zoom-btn" onclick="zoom('merge', 1.2)" title="Zoom in" aria-label="Zoom in">+</div>
						<div class="zoom-btn" onclick="zoom('merge', 0.8)" title="Zoom out" aria-label="Zoom out">−</div>
						<div class="zoom-btn" onclick="resetZoom('merge')" title="Reset zoom" aria-label="Reset zoom">⟲</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<!-- JavaScript files in the correct dependency order -->
	<script src="js/mergesort-init.js"></script>
	<script src="js/mergesort-core.js"></script>
	<script src="js/mergesort-visualization.js"></script>
	<script src="js/mergesort-bridge.js"></script>
	<script src="js/mergesort-algorithm.js"></script>
	<script src="js/particles-config.js"></script>
	
	<!-- Button click handlers -->
	<script>
		// Connect button onclick handlers after all scripts have loaded
		document.addEventListener('DOMContentLoaded', function() {
			// Connect button click events
			document.getElementById('startSortBtn').addEventListener('click', startSort);
			document.getElementById('resetBtn').addEventListener('click', resetVisualization);
			document.getElementById('pauseResumeBtn').addEventListener('click', togglePause);
            
            // Initialize particles with enhanced settings
            setTimeout(function() {
                try {
                    // Use the enhanced config settings
                    particlesJS('particles-js', {
                        particles: {
                            number: { value: 100 },
                            shape: { 
                                type: ["circle", "triangle", "edge", "star", "polygon"]
                            },
                            size: { value: 5 },
                            move: { speed: 1 }, // Default speed
                            opacity: { value: 0.7 },
                            line_linked: {
                                enable: true,
                                distance: 120,
                                color: "#ffffff",
                                opacity: 0.7,
                                width: 2.5
                            }
                        },
                        interactivity: {
                            detect_on: "canvas",
                            events: {
                                onhover: {
                                    enable: true,
                                    mode: ["grab", "bubble"]
                                },
                                onclick: {
                                    enable: true,
                                    mode: "push"
                                }
                            },
                            modes: {
                                grab: {
                                    distance: 200,
                                    line_linked: { opacity: 0.6 }
                                },
                                bubble: {
                                    distance: 150,
                                    size: 8,
                                    duration: 2,
                                    opacity: 0.8
                                },
                                push: {
                                    particles_nb: 5
                                }
                            }
                        }
                    });
                    console.log('Enhanced particles initialized');
                } catch (e) {
                    console.error('Particle initialization failed:', e);
                    // Use the config from particles-config.js as fallback
                    if (typeof particlesConfig !== 'undefined') {
                        particlesJS('particles-js', particlesConfig);
                    }
                }
            }, 100);
		});
	</script>
</body>
</html>
